# è‰æ¢… Auth é‡æ„æ–¹æ¡ˆ

## æ¦‚è¿°

æœ¬æ–¹æ¡ˆé’ˆå¯¹é¡¹ç›®å½“å‰æš´éœ²å‡ºçš„é«˜è€¦åˆã€æ–‡ä»¶ä½“é‡è¿‡å¤§ã€é‡å¤ä»£ç ã€æµ‹è¯•è¦†ç›–ä¸è¶³ä»¥åŠæ–‡æ¡£æ»åç­‰é—®é¢˜ï¼Œæå‡ºä¸€ç»„å¯è¿­ä»£è½åœ°çš„å·¥ç¨‹æ”¹é€ ä¸¾æªã€‚æ•´ä½“ç›®æ ‡æ˜¯åœ¨ä¸å½±å“ç°æœ‰åŠŸèƒ½çš„å‰æä¸‹ï¼Œé€æ­¥æå‡ä»£ç è´¨é‡ä¸å¯ç»´æŠ¤æ€§ï¼Œä¸ºåç»­éœ€æ±‚è¿­ä»£å’Œå¤šç«¯éƒ¨ç½²å¥ å®šåŸºç¡€ã€‚

## ç›®æ ‡æ‘˜è¦

| ç¼–å· | ç›®æ ‡             | æˆåŠŸæ ‡å‡†                                                                                                 |
| ---- | ---------------- | -------------------------------------------------------------------------------------------------------- |
| G1   | é™ä½è€¦åˆåº¦       | çº¯å‡½æ•°ï¼ˆçº¯é€»è¾‘ï¼‰ä¸å‰¯ä½œç”¨ä»£ç åˆ†å±‚ï¼Œå…¬å…±é€»è¾‘è¿ç§»åˆ° `utils/**` æˆ–å¯å¤ç”¨ hooksï¼›æ ¸å¿ƒæ¨¡å—ä¾èµ–æ–¹å‘å•å‘ã€å¯æ³¨å…¥ |
| G2   | æ§åˆ¶æ–‡ä»¶é•¿åº¦     | å•æ–‡ä»¶é•¿åº¦ â‰¤ 600 è¡Œï¼Œæ–°å¢ ESLint `max-lines` è§„åˆ™å®ˆæŠ¤                                                    |
| G3   | æå‡å¤ç”¨ç‡       | é‡å¤é€»è¾‘æŠ½è±¡ä¸º composableã€æŒ‡ä»¤æˆ– utilï¼Œåˆ å‡ â‰¥ 70% æ ·æ¿ä»£ç ï¼ˆè¡¨å•ã€API åŒ…è£…ã€æ ¡éªŒç­‰ï¼‰                    |
| G4   | æµ‹è¯•è¦†ç›–ç‡ â‰¥ 60% | `pnpm test --coverage` è¯­å¥è¦†ç›– â‰¥ 60%ã€åˆ†æ”¯ â‰¥ 50%ï¼›CI é˜»æ–­å›é€€                                           |
| G5   | æ–‡æ¡£åŒæ­¥         | `docs/**`ã€READMEã€CHANGELOG ä¸ä»£ç æ”¹åŠ¨ä¿æŒä¸€è‡´ï¼Œæä¾›è¿ç§»æŒ‡å—ä¸æµ‹è¯•æŠ¥å‘Š                                  |

## å·¥ä½œæµä¸æªæ–½

### 1. è§£è€¦é€»è¾‘ä¸å‰¯ä½œç”¨ï¼ˆG1ï¼‰

-   **æ¨¡å—æ¢³ç†**ï¼šåˆ—å‡ºæ‰€æœ‰æ‰§è¡Œ I/Oã€ç½‘ç»œã€æ•°æ®åº“ã€å‰¯ä½œç”¨çš„æ¨¡å—ï¼Œç¡®å®šçº¯é€»è¾‘è¾¹ç•Œã€‚ä¼˜å…ˆå¤„ç† `server/utils/email.ts`, `server/utils/phone.ts`, `lib/auth-client.ts`, å„é¡µé¢å†…è”çš„ä¸šåŠ¡é€»è¾‘ã€‚
-   **åˆ†å±‚ç­–ç•¥**ï¼š
    -   çº¯é€»è¾‘è¿ç§»åˆ° `utils/pure/**`ï¼ˆæˆ–ç°æœ‰ util æ–‡ä»¶ä¸­ï¼‰å¹¶ä»¥å‡½æ•°å½¢å¼æš´éœ²ã€‚
    -   å‰¯ä½œç”¨å±‚ï¼ˆAPIã€æ•°æ®åº“ã€ç¬¬ä¸‰æ–¹ SDKï¼‰ä»…ä¾èµ–çº¯é€»è¾‘ï¼Œé€šè¿‡ä¾èµ–æ³¨å…¥/å‚æ•°ä¼ é€’å…±äº«é€»è¾‘ç»“æœã€‚
    -   Vue ç»„ä»¶å’Œ composable ä»…è°ƒç”¨å‰¯ä½œç”¨å±‚æˆ–çº¯é€»è¾‘å±‚ï¼Œç¦æ­¢ç›´æ¥æ·±å…¥ server utilã€‚
-   **æŠ€æœ¯æªæ–½**ï¼š
    -   å»ºç«‹ `@/utils/factory/*` ç”¨äºåˆ›å»ºå¸¦å‰¯ä½œç”¨çš„å®ä¾‹ï¼ˆå¦‚ Twilioã€Nodemailerï¼‰ï¼Œä¾¿äºåœ¨æµ‹è¯•ä¸­ mockã€‚
    -   ä½¿ç”¨ `injectNavigationDeps` / `provide/inject` æ–¹æ¡ˆéš”ç¦» Nuxt auto-import å¯¹æµ‹è¯•çš„å½±å“ã€‚
-   **éªŒæ”¶**ï¼šå…³é”®æ¨¡å—ï¼ˆé‚®ä»¶ã€çŸ­ä¿¡ã€éªŒè¯ç ã€auth flowsï¼‰å‡å…·å¤‡çº¯å‡½æ•°å•æµ‹ä¸å‰¯ä½œç”¨é›†æˆæµ‹ï¼›ä»£ç ä¾èµ–å›¾æ— å¾ªç¯å¼•ç”¨ã€‚

#### G1 ç°çŠ¶è¯Šæ–­

-   **æœåŠ¡å™¨ä¾§å‰¯ä½œç”¨æ··æ‚ï¼ˆéƒ¨åˆ†å·²ç¼“è§£ï¼‰**ï¼š`server/utils/phone.ts` ä»åŒæ—¶æ‰¿æ‹…é™æµã€æ¨¡æ¿æ‹¼è£…ã€ç¬¬ä¸‰æ–¹ SDK åˆå§‹åŒ–å’Œå¤±è´¥å…œåº•ï¼Œå¯¼è‡´ twilio/Spug ç­‰å®ä¾‹åœ¨å‡½æ•°å†…éƒ¨ç¡¬ç¼–ç ï¼Œä»»ä½•æµ‹è¯•éƒ½å¿…é¡»çœŸè¿å¤–éƒ¨æœåŠ¡ã€‚`server/utils/email.ts` å·²äº 2025-11-19 å¼•å…¥ä¾èµ–æ³¨å…¥ä¸å·¥å‚å°è£…ï¼Œç°é˜¶æ®µé‡ç‚¹è½¬å‘çŸ­ä¿¡æ¨¡å—ã€‚é™æµé€»è¾‘ä»åœ¨å¤šä¸ªæ¸ é“é‡å¤ä¸€éï¼ˆ`limiterStorage.increment` + æ—¥å¿—è®°å½•ï¼‰ï¼Œä¸”å’Œæ–‡æ¡ˆè€¦åˆï¼Œé˜»ç¢åç»­æ–°å¢æ¸ é“ã€‚
-   **å‰ç«¯é¡µé¢ç›´æ¥å¤„ç†é‰´æƒæµç¨‹**ï¼š`pages/login.vue`ï¼ˆ1076 è¡Œï¼‰ã€`pages/register.vue`ï¼ˆ743 è¡Œï¼‰å’Œ `pages/security.vue`ï¼ˆ1109 è¡Œï¼‰åœ¨ `<script setup>` å†…å®Œæˆ form stateã€å­—æ®µæ ¡éªŒã€éªŒè¯ç è§£æã€`authClient` è°ƒç”¨ã€toast æç¤ºä¸å¯¼èˆªé€»è¾‘ï¼Œç¼ºå°‘ composable æˆ– service å±‚ã€‚ä»»ä½•å‰¯ä½œç”¨ï¼ˆå¦‚ `resolveCaptchaToken`ã€`authClient.phoneNumber.sendOtp`ï¼‰éƒ½ç›´æ¥è€¦åˆåœ¨é¡µé¢ï¼Œå¯¼è‡´é¡µé¢æ— æ³•åœ¨å•å…ƒæµ‹è¯•é‡Œè¢« mockã€‚
-   **é€šç”¨æµç¨‹æœªæŠ½è±¡**ï¼š`utils/code.ts` æ—¢è®¿é—® UI ç»„ä»¶ï¼ˆ`useToast`ã€`CaptchaExpose`ï¼‰åˆç›´æ¥æ¶ˆè´¹ `authClient`ï¼Œç¼ºä¹ä¾èµ–æ³¨å…¥ã€‚å³ä¾¿é¡µé¢æƒ³æ¥å…¥åˆ«çš„éªŒè¯ç æä¾›å•†ï¼Œä¹Ÿåªèƒ½å¤åˆ¶æ•´æ®µé€»è¾‘ã€‚
-   **ä¾èµ–å€’ç½®å°šæœªå½¢æˆä½“ç³»**ï¼šç›®å‰é‡‡ç”¨ DI çš„æ¨¡å—æœ‰ `utils/navigation.ts`ï¼ˆ`injectNavigationDeps`ï¼‰ä¸ `server/utils/email.ts`ï¼Œå…¶ä½™æ¨¡å—ä»ç›´æ¥å¼•ç”¨ Nuxt auto-import æˆ–ç¬¬ä¸‰æ–¹å®ä¾‹ã€‚è¦è½å® G1ï¼Œéœ€è¦æŠŠ factory/dependency pattern ä¸‹æ²‰åˆ°çŸ­ä¿¡ã€éªŒè¯ç ã€æ—¥å¿—ç­‰å…³é”®è·¯å¾„ã€‚

#### G1 è¿‘æœŸè¿›å±•

-   âœ… 2025-11-19ï¼šå®Œæˆ `server/utils/email.ts` çš„ä¾èµ–æ³¨å…¥ä¸é™æµè§£è€¦ï¼Œå¼•å…¥ `injectEmailDeps`/`resetEmailDeps`ï¼Œå¹¶å¤ç”¨ `utils/factory/mailer.ts` ä»¥ä¾¿åœ¨æµ‹è¯•ç¯å¢ƒä¸­æ³¨å…¥å‡å®ç°ã€‚
-   âœ… 2025-11-19ï¼šæ–°å»º `utils/factory/mailer.ts` å’Œ `tests/unit/server/email.spec.ts`ï¼Œè¦†ç›–æˆåŠŸå‘é€ä¸å…¨å±€é™æµä¸¤æ¡è·¯å¾„ï¼Œä¸ºåç»­çŸ­ä¿¡æ¨¡å—æä¾›å‚è€ƒèŒƒå¼ã€‚

#### G1 æ‹†è§£è¦ç‚¹

1. **å»ºç«‹å‰¯ä½œç”¨å·¥å‚**ï¼šåœ¨ `utils/factory/mailer.ts`ã€`utils/factory/sms.ts` ä¸­é›†ä¸­åˆ›å»º nodemailer/twilio/spug å®¢æˆ·ç«¯ï¼Œå¹¶æš´éœ²å¯ Mock çš„å·¥å‚æ–¹æ³•ã€‚`server/utils/email.ts`ã€`server/utils/phone.ts` ä»…è´Ÿè´£ orchestrateï¼ˆé™æµç»“æœ + provider è°ƒåº¦ï¼‰ã€‚
2. **æŠ½ç¦»çº¯é€»è¾‘**ï¼šå°†é™æµ key ç”Ÿæˆã€é”™è¯¯æ–‡æ¡ˆã€éªŒè¯ç æœ‰æ•ˆæœŸè®¡ç®—ç­‰çº¯å‡½æ•°æ”¾å…¥ `utils/shared/rate-limit.ts`ã€`utils/shared/otp.ts`ï¼Œä¾› server å’Œ client å¤ç”¨ï¼Œé¿å…åœ¨ä¸åŒå‰¯ä½œç”¨æ–‡ä»¶ä¸­å¤åˆ¶ã€‚æ‰€æœ‰çº¯å‡½æ•°å…ˆè¡¥å•æµ‹ï¼Œå†è¢« service å±‚å¼•ç”¨ã€‚
3. **å‰ç«¯æµç¨‹æ¨¡å—åŒ–**ï¼šä¸ºç™»å½•/æ³¨å†Œ/å®‰å…¨é¡µé¢åˆ›å»º `composables/useLoginForm.ts`, `useRegisterFlow.ts`, `useSecuritySettings.ts`ï¼Œç”± composable ç®¡ç† `authClient` è°ƒç”¨ã€captcha tokenã€toastï¼Œè€Œé¡µé¢ä»…èšç„¦ UIã€‚`utils/code.ts` åº”æ‹†æˆçº¯é€»è¾‘ï¼ˆç»„è£…è¯·æ±‚å‚æ•°ï¼‰+ UI hookï¼ˆæ³¨å…¥ toastã€captchaï¼‰ã€‚
4. **å¼•å…¥ä¾èµ–æ³¨å…¥çº¦å®š**ï¼šæ‰©å±• `injectNavigationDeps` æ¨¡å¼åˆ°éªŒè¯ç ã€authClient è°ƒç”¨ï¼Œçº¦å®šæ‰€æœ‰æ¶‰åŠå¤–éƒ¨ I/O çš„æ¨¡å—å¿…é¡»å¯¼å‡º `inject*Deps`ï¼ˆæˆ–ç±»ä¼¼ `injectSmsDeps`ã€`injectCaptchaDeps`ï¼‰çš„ APIï¼Œé»˜è®¤å®ç°å¼•ç”¨ Nuxt auto-importï¼Œåœ¨æµ‹è¯•ä¸­å¯æ›¿æ¢ã€‚
5. **é…å¥—æµ‹è¯•ç­–ç•¥**ï¼šåœ¨ service æ‹†åˆ†å®Œæˆåï¼Œä¸º rate-limit çº¯å‡½æ•°å’Œ provider è°ƒåº¦å†™ Vitestï¼Œmock nodemailer/twilio å·¥å‚ä»¥éªŒè¯é”™è¯¯è·¯å¾„ï¼Œç¡®ä¿éªŒæ”¶æŒ‡æ ‡ï¼ˆå…³é”®æ¨¡å—éƒ½æœ‰çº¯å‡½æ•° & é›†æˆæµ‹ï¼‰å¯é‡åŒ–ã€‚

#### G1 ä¼˜å…ˆæ”¹é€ æ–‡ä»¶æ¸…å•ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

| æ–‡ä»¶                    | å½“å‰ç—‡çŠ¶                                                                                                                                                             | è®¡åˆ’åŠ¨ä½œ                                                                                                                                                                       | ä¼˜å…ˆçº§   | çŠ¶æ€                    |
| ----------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------- | ----------------------- |
| `server/utils/email.ts` | å‘é€æµç¨‹åŒæ—¶åˆ›å»º transporterã€è¯»å– envã€åšé™æµå’Œæ—¥å¿—ï¼Œ`transporter.verify()` æ¯æ¬¡è°ƒç”¨éƒ½ä¼šè§¦å‘çœŸå®ç½‘ç»œï¼›é™æµé€»è¾‘ä¸çŸ­ä¿¡æ¨¡å—é‡å¤ã€‚                                      | æ‹†åˆ†ä¸º `emailRateLimit` çº¯å‡½æ•° + `createMailer` å·¥å‚ï¼›`sendEmail` ä¿ç•™ orchestrator è§’è‰²ï¼Œå¼•å…¥ä¾èµ–æ³¨å…¥ä»¥ä¾¿åœ¨æµ‹è¯• / Worker ç¯å¢ƒæ›¿æ¢å®ç°ã€‚                                       | Critical | âœ… å·²å®Œæˆï¼ˆ2025-11-19ï¼‰ |
| `server/utils/phone.ts` | å•æ–‡ä»¶å†…åµŒ Spug/Twilio classã€é™æµä¸æ—¥å¿—æ··æ‚ï¼›`fetch` å’Œ `twilio()` ç›´æ¥åœ¨è¿è¡ŒæœŸæ‰§è¡Œï¼Œéš¾ä»¥ mockï¼›æ‰‹æœºæ ¼å¼æ ¡éªŒä¸ provider å¼ºè€¦åˆã€‚                                    | å°† provider å®šä¹‰ç§»åŠ¨åˆ° `utils/providers/sms/*`; æŠ½å‡º `resolveSmsProvider(channel)` ä¸é™æµå·¥å…·ï¼›å‘å¤–æš´éœ² `injectSmsDeps` æ³¨å…¥ fetch/twilio clientã€‚                             | Critical | âœ… å·²å®Œæˆï¼ˆ2025-11-20ï¼‰ |
| `pages/login.vue`       | 1076 è¡Œè„šæœ¬åŒ…å«è¡¨å•çŠ¶æ€ã€æ ¡éªŒã€éªŒè¯ç è§£æã€OTP å‘é€ã€2FA å¯¹è¯æ¡†ç­‰æ‰€æœ‰å‰¯ä½œç”¨ï¼Œæ— æ³•åœ¨å…¶ä»–å…¥å£å¤ç”¨ï¼›ä¸ `pages/register.vue`ã€`pages/forgot-password.vue` é€»è¾‘é«˜åº¦é‡å¤ã€‚ | æ–°å»º `composables/useLoginFlow.ts`ï¼ˆé›†ä¸­ç®¡ç† captcha/OTP/authClient è°ƒç”¨ï¼‰å’Œ UI å­ç»„ä»¶ï¼›é¡µé¢ä»…ç»‘å®š composable çš„å“åº”å¼ stateã€‚                                                 | Critical | âœ… å·²å®Œæˆï¼ˆ2025-11-20ï¼‰ |
| `utils/code.ts`         | hook å†…éƒ¨ç›´æ¥å¼•ç”¨ `useToast`ã€`authClient`ã€`setTimeout`ï¼Œæ—¢åŒ…å«ä¸šåŠ¡æµç¨‹ä¹ŸåŒ…å« UI æç¤ºï¼Œæ— æ³•åœ¨ SSR/æµ‹è¯•ä¸­æ³¨å…¥æ›¿ä»£å®ç°ã€‚                                              | æ‹†åˆ†ä¸º `useOtpDispatcher`ï¼ˆä»…å¤„ç† UI toastï¼‰+ `createOtpService`ï¼ˆçº¯å‡½æ•°ï¼Œæ¥å— `sendOtp`/`captchaResolver`ï¼‰å¹¶æä¾›ä¾èµ–æ³¨å…¥ï¼Œä¾›ç™»å½•/æ³¨å†Œ/å®‰å…¨é¡µé¢å…±äº«ã€‚                         | High     | âœ… å·²å®Œæˆï¼ˆ2025-11-20ï¼‰ |
| `pages/register.vue`    | ä¸ç™»å½•é¡µå…±äº« 70% è¡¨å•/éªŒè¯ç /é”™è¯¯æç¤ºé€»è¾‘ï¼Œä½†ç›®å‰å¤åˆ¶ç²˜è´´ï¼›ç›´æ¥è§¦å‘ `authClient` å’ŒéªŒè¯ç ï¼Œè¿èƒŒâ€œé¡µé¢ä¸ç›´æ¥è§¦è¾¾å‰¯ä½œç”¨å±‚â€çš„ç›®æ ‡ã€‚                                      | å¤ç”¨ `useRegisterFlow` composableï¼Œé‡æ„æˆ UI-only é¡µé¢ï¼Œå¹¶ä¸ç™»å½•é¡µé¢å…±äº« OTP/æ ¡éªŒé€»è¾‘æ¨¡å—ã€‚                                                                                    | High     | âœ… å·²å®Œæˆï¼ˆ2025-11-20ï¼‰ |
| `pages/security.vue`    | 1109 è¡Œè„šæœ¬å†…ç›´æ¥å¤„ç† 2FAã€å¤‡ä»½ç ã€ä¼šè¯æ’¤é”€ï¼ˆ`authClient.session.revoke*`ï¼‰ã€äºŒç»´ç ç”Ÿæˆï¼ˆ`QRCode`ï¼‰ç­‰å‰¯ä½œç”¨ï¼Œé€»è¾‘ä¸ UI ç´§è€¦åˆã€‚                                      | æ‹†æˆ `useSecuritySettings` composable + è‹¥å¹² presentational ç»„ä»¶ (`SecurityTwoFactorPanel`, `SecuritySessionTable`)ï¼ŒäºŒç»´ç ç”Ÿæˆ/å¤‡ä»½ç ä¸‹è½½æ”¾åˆ° util/service å±‚ï¼Œæ–¹ä¾¿ç‹¬ç«‹æµ‹è¯•ã€‚ | High     | âœ… å·²å®Œæˆï¼ˆ2025-11-20ï¼‰ |

> å…¶ä½™æ–‡ä»¶ï¼ˆå¦‚ `server/utils/admin-role-sync.ts`, `lib/auth-client.ts`ï¼‰åœ¨å®Œæˆä¸Šè¿°å…³é”®æ”¹é€ åå†æŒ‰ä¾èµ–é“¾æ¨è¿›ï¼Œé¿å…ä¸€æ¬¡æ€§å¤§æ”¹é€ æˆé£é™©ã€‚

### 2. æ§åˆ¶æ–‡ä»¶é•¿åº¦ï¼ˆG2ï¼‰

-   **ç›®æ ‡**ï¼šå•æ–‡ä»¶é•¿åº¦ â‰¤ 600 è¡Œï¼ˆåŸºäº ESLint é…ç½®ï¼‰ã€‚
-   **åŸºçº¿æ‰«æ**ï¼ˆ2025-12-03ï¼‰ï¼š

    -   `pages/admin/oauth/applications.vue` (2121 è¡Œ) -> âœ… å·²æ‹†åˆ† (2025-12-03)
    -   `pages/admin/users.vue` (1868 è¡Œ) -> âœ… å·²æ‹†åˆ† (2025-12-03)
    -   `pages/admin/sso/providers.vue` (1753 è¡Œ) -> âœ… å·²æ‹†åˆ† (2025-12-03)
    -   `pages/profile.vue` (1199 è¡Œ) -> âœ… å·²æ‹†åˆ† (2025-12-03)
    -   `pages/admin/logs.vue` (1184 è¡Œ) -> âœ… å·²æ‹†åˆ† (2025-12-03)
    -   `server/utils/email-template.ts` (922 è¡Œ) -> âœ… å·²æ‹†åˆ†è‡³ 278 è¡Œ (2025-12-03)

-   **æ‹†åˆ†ç­–ç•¥**ï¼š

    1.  **ç®¡ç†åå°é¡µé¢ (`pages/admin/**`)\*\*ï¼š
        -   **ç°è±¡**ï¼šè¡¨æ ¼åˆ—å®šä¹‰ã€è¡¨å•éªŒè¯è§„åˆ™ã€CRUD é€»è¾‘ã€UI æ¨¡ç‰ˆå †ç§¯ã€‚
        -   **å¯¹ç­–**ï¼š
            -   æå–è¡¨æ ¼åˆ—é…ç½®åˆ° `composables/admin/use-*-columns.ts`ã€‚
            -   æå–è¡¨å•é€»è¾‘åˆ° `composables/admin/use-*-form.ts`ã€‚
            -   å°†å¼¹çª—ï¼ˆDialog/Drawerï¼‰æ‹†åˆ†ä¸ºç‹¬ç«‹ç»„ä»¶ï¼ˆå¦‚ `components/admin/user-edit-dialog.vue`ï¼‰ã€‚
    2.  **ä¸ªäººä¸­å¿ƒ (`pages/profile.vue`)**ï¼š
        -   **ç°è±¡**ï¼šåŒ…å«åŸºæœ¬èµ„æ–™ã€å®‰å…¨è®¾ç½®ã€ç¤¾äº¤ç»‘å®šç­‰å¤šä¸ªæ¿å—ã€‚
        -   **å¯¹ç­–**ï¼šæŒ‰ Tab æ‹†åˆ†ä¸ºå­ç»„ä»¶ `components/profile/basic-info.vue`, `components/profile/social-binding.vue` ç­‰ã€‚
    3.  **é‚®ä»¶æ¨¡æ¿ (`server/utils/email-template.ts`)**ï¼š
        -   **ç°è±¡**ï¼šç¡¬ç¼–ç äº†å¤§é‡ HTML å­—ç¬¦ä¸²ã€‚
        -   **å¯¹ç­–**ï¼šå°† HTML æ¨¡æ¿ç§»è‡³ `server/templates/` ç›®å½•ï¼Œæˆ–æ‹†åˆ†ä¸ºå¤šä¸ªæ¨¡æ¿ç”Ÿæˆå‡½æ•°æ–‡ä»¶ `server/utils/templates/*.ts`ã€‚

-   **é™æ€è§„åˆ™**ï¼š

    -   `eslint.config.js` å·²é…ç½® `'max-lines': [1, { max: 600 }]`ã€‚
    -   CI é˜¶æ®µè¿è¡Œ `npm run lint` ç¡®ä¿æ— æ–°å¢è¶…æ ‡æ–‡ä»¶ã€‚

-   **éªŒæ”¶**ï¼š`npm run lint` ç»“æœä¸­æ—  `max-lines` è­¦å‘Šã€‚

### 3. æå‡ä»£ç å¤ç”¨ï¼ˆG3ï¼‰

-   **ç°çŠ¶åˆ†æ**ï¼š

    -   **UI ç»„ä»¶é‡å¤**ï¼šå¤šä¸ªç®¡ç†åå°é¡µé¢ï¼ˆ`admin/users`, `admin/oauth/*`ï¼‰é‡å¤å®ç°è¡¨æ ¼åˆ†é¡µã€æœç´¢ã€åŠ è½½çŠ¶æ€é€»è¾‘ï¼›ç™»å½•/æ³¨å†Œé¡µé¢é‡å¤å®ç°è¡¨å•å­—æ®µå¸ƒå±€å’Œé”™è¯¯æ˜¾ç¤ºã€‚
    -   **é€»è¾‘é‡å¤**ï¼šAPI è¯·æ±‚çš„é”™è¯¯å¤„ç†ï¼ˆToast æç¤ºã€401 è·³è½¬ï¼‰æ•£è½åœ¨å„ä¸ªé¡µé¢ï¼›è¡¨å•æ ¡éªŒè§„åˆ™ï¼ˆå¦‚æ‰‹æœºå·ã€å¯†ç å¼ºåº¦ï¼‰åœ¨å‰ç«¯ç»„ä»¶å’Œåç«¯ DTO ä¸­å¯èƒ½å­˜åœ¨ä¸ä¸€è‡´ã€‚
    -   **æ ·å¼é‡å¤**ï¼šSCSS ä¸­å­˜åœ¨å¤šå¤„ç¡¬ç¼–ç çš„é¢œè‰²å’Œé—´è·ï¼Œæœªå®Œå…¨åˆ©ç”¨ `_variables.scss` å’Œ `_mixins.scss`ã€‚

-   **å®æ–½æ–¹æ¡ˆ**ï¼š

    #### 3.1 å»ºç«‹åŸºç¡€ç»„ä»¶åº“ (`components/base`)

    -   **ç›®æ ‡**ï¼šæ„å»ºä¸€å¥—ä¸ä¸šåŠ¡è§£è€¦çš„åŸå­ç»„ä»¶ï¼Œç»Ÿä¸€ UI äº¤äº’ä¸æ ·å¼ã€‚
    -   **è¿›åº¦**ï¼š
        -   âœ… `input.vue`ï¼šå·²å®Œæˆã€‚å°è£…äº† Labelã€Error Messageã€v-model ç»‘å®šã€‚
        -   âœ… `password.vue`ï¼šå·²å®Œæˆã€‚å°è£…äº†å¯†ç è¾“å…¥ã€æ˜¾éšåˆ‡æ¢ã€‚
        -   âœ… `phone-input.vue`ï¼šå·²å®Œæˆã€‚å°è£…äº†å›½é™…åŒºå·é€‰æ‹©ã€æ‰‹æœºå·æ ¼å¼åŒ–ã€‚
        -   âœ… `table.vue`ï¼šå·²å®Œæˆã€‚å°è£…äº† PrimeVue DataTableï¼Œç»Ÿä¸€åˆ†é¡µå™¨ã€Loading æ€ã€ç©ºçŠ¶æ€å±•ç¤ºã€‚
        -   âœ… `form-group.vue`ï¼šå·²å®Œæˆã€‚å°è£… Labelã€Error Message å¸ƒå±€ï¼Œç”¨äºåŒ…è£¹ Selectã€Checkbox ç­‰æ— éœ€æ·±åº¦å°è£…çš„ç»„ä»¶ï¼Œæ›¿ä»£ `BaseSelect`ã€‚
        -   âœ… `base-dialog.vue`ï¼šå·²å®Œæˆã€‚å°è£… PrimeVue Dialogï¼Œç»Ÿä¸€ Header/Footer å¸ƒå±€ã€Loading çŠ¶æ€ã€å®½åº¦å“åº”å¼ã€‚
        -   âœ… **ç§»é™¤å†—ä½™ Dialog**ï¼šå¼•å…¥ PrimeVue `ConfirmService`ï¼Œå°† `logout-confirm-dialog`, `delete-*-dialog` ç­‰çº¯ç¡®è®¤ç±»ç»„ä»¶æ›¿æ¢ä¸º `useConfirm()` è°ƒç”¨ï¼Œå‡å°‘æ–‡ä»¶æ•°é‡ã€‚
        -   âœ… `status-badge.vue`ï¼šå·²å®Œæˆã€‚æ¶ˆé™¤ç¡¬ç¼–ç çš„ä¸‰å…ƒè¡¨è¾¾å¼ï¼ˆå¦‚ `enabled ? 'success' : 'danger'`ï¼‰ï¼Œç»Ÿä¸€ç®¡ç† User/App/Session ç­‰ä¸åŒå®ä½“çš„çŠ¶æ€é¢œè‰²ä¸æ–‡æ¡ˆæ˜ å°„ã€‚
    -   **è¡ŒåŠ¨**ï¼š
        1. âœ… åˆ›å»º `components/base` ç›®å½•ã€‚
        2. âœ… æå– `admin/users.vue` ä¸­çš„è¡¨æ ¼é€»è¾‘ä¸º `BaseTable`ã€‚
        3. âœ… æå– `login.vue`, `register.vue`, `forgot-password.vue`, `quick-login.vue` ä¸­çš„è¾“å…¥æ¡†ä¸º `BaseInput`, `BasePassword`, `BasePhoneInput`ã€‚
        4. âœ… **å…¨é‡æ¨å¹¿**ï¼šæ£€æŸ¥æ‰€æœ‰é¡µé¢ï¼ˆå¦‚ `profile.vue`, `admin/**`ï¼‰ï¼Œå°†å‰©ä½™çš„ç¡¬ç¼–ç ç»„ä»¶æ›¿æ¢ä¸º Base ç»„ä»¶ã€‚

    #### 3.2 æå–é€šç”¨ Composables (`composables/core`)

    -   **ç›®æ ‡**ï¼šå°†çŠ¶æ€é€»è¾‘ä» UI ç»„ä»¶ä¸­å‰¥ç¦»ã€‚
    -   **è¿›åº¦**ï¼šğŸš§ è¿›è¡Œä¸­
    -   **æ ¸å¿ƒ Composables**ï¼š
        -   âœ… `useDataTable<T>(fetcher)`ï¼šç®¡ç†åˆ†é¡µ (`page`, `limit`)ã€æ’åº (`sort`)ã€è¿‡æ»¤ (`query`)ã€åŠ è½½çŠ¶æ€ (`pending`)ã€‚
        -   âœ… `useForm<T>(schema)`ï¼šé›†æˆ `zod` æˆ– `valibot`ï¼Œç®¡ç†è¡¨å•çŠ¶æ€ã€æ ¡éªŒé”™è¯¯ä¿¡æ¯ã€æäº¤çŠ¶æ€ (`submitting`)ã€‚
        -   âœ… `useApi<T>(url, options)`ï¼šå°è£… `useFetch`ï¼Œç»Ÿä¸€å¤„ç†å…¨å±€é”™è¯¯ï¼ˆå¦‚ç½‘ç»œå¼‚å¸¸ã€Token è¿‡æœŸè‡ªåŠ¨åˆ·æ–°ï¼‰ã€‚
    -   **æ–°å¢è§„åˆ’ (2025-12-08)**ï¼š
        -   âœ… `useClipboard`ï¼šå°è£… `navigator.clipboard` ä¸ Toast æç¤ºï¼Œç»Ÿä¸€å¤åˆ¶äº¤äº’ï¼ˆå·²å®ç°äº `composables/utils/use-clipboard.ts`ï¼‰ã€‚
        -   âœ… `useConfirmAction`ï¼šå°è£… `useConfirm`ï¼Œé¢„è®¾åˆ é™¤ã€ç™»å‡ºç­‰å¸¸ç”¨åœºæ™¯é…ç½®ï¼ˆå·²å®ç°äº `composables/utils/use-confirm-action.ts`ï¼‰ã€‚
        -   âœ… `usePageMeta`ï¼šç»Ÿä¸€ SEO æ ‡é¢˜æ ¼å¼ä¸ Open Graph æ ‡ç­¾ç”Ÿæˆï¼ˆå·²å®ç°äº `composables/utils/use-page-meta.ts`ï¼‰ã€‚
        -   âœ… `useLogout`ï¼šç»Ÿä¸€ç™»å‡ºé€»è¾‘ä¸çŠ¶æ€ç®¡ç†ï¼ˆå·²å®ç°äº `composables/utils/use-logout.ts`ï¼‰ã€‚
        -   âœ… `useStorage`ï¼šå“åº”å¼æœ¬åœ°å­˜å‚¨å°è£…ï¼ˆæ›¿ä»£ç›´æ¥è°ƒç”¨ `localStorage`ï¼‰--é‡‡ç”¨ VueUseï¼ˆå·²å®ç°äº `composables/utils/use-storage.ts`ï¼‰ã€‚
    -   **è¡ŒåŠ¨**ï¼š
        1. âœ… æ”¹é€  `composables/admin/use-user-management.ts` ä½¿ç”¨ `useDataTable`ã€‚
        2. âœ… æ”¹é€  Auth ç›¸å…³è¡¨å•ä½¿ç”¨ `useForm`ï¼ˆæˆ–ç»§ç»­ä¼˜åŒ– G1 ä¸­çš„ `useLoginFlow`ï¼‰ã€‚
            - âœ… `composables/use-register-flow.ts`
            - âœ… `composables/use-change-password-flow.ts`
            - âœ… `components/admin/users/create-user-dialog.vue`
            - âœ… `components/admin/users/user-detail-dialog.vue`
            - âœ… `components/profile/dialogs/*.vue`
        3. â¬œ æ›¿æ¢ç°æœ‰ç¡¬ç¼–ç é€»è¾‘ä¸ºä¸Šè¿°æ–°å¢ Composablesã€‚

    #### 3.3 ç»Ÿä¸€æ ¡éªŒä¸å·¥å…· (`utils/shared`)

    -   **ç›®æ ‡**ï¼šå®ç°å‰åç«¯æ ¡éªŒé€»è¾‘åŒæ„ï¼Œé¿å…é€»è¾‘åŒç»´æŠ¤ã€‚
    -   **åˆ†æä¸å†³ç­–**ï¼šè¯¦è§ [ç»Ÿä¸€æ ¡éªŒæ–¹æ¡ˆåˆ†æä¸å†³ç­–](./architecture/validation.md)ã€‚å¼•å…¥ Zod ä»¥è§£å†³å½“å‰ `validator` + æ­£åˆ™æ¨¡å¼çš„ç±»å‹ç¼ºå¤±å’Œé€»è¾‘é‡å¤é—®é¢˜ã€‚
    -   **è¿›åº¦**ï¼šâœ… å·²å®Œæˆ (2025-12-08)
    -   **è¡ŒåŠ¨**ï¼š
        1. âœ… å»ºç«‹ `utils/shared/validators.ts`ï¼šå­˜æ”¾ Zod Schemaï¼ˆå¦‚ `emailSchema`, `passwordSchema`, `phoneSchema`ï¼‰ã€‚
        2. âœ… æ”¹é€  `composables/core/use-form.ts` æ”¯æŒ Zod Schemaã€‚
        3. âœ… æ”¹é€  `useRegisterFlow`, `useLoginFlow`, `useForgotPasswordFlow` ä½¿ç”¨ Zod Schemaã€‚
        4. âœ… æ”¹é€  `utils/smart-input.ts` å’Œ SMS Providers ä½¿ç”¨ Zod Schemaã€‚

    #### 3.4 utils åˆ†å±‚ä¸å¤ç”¨ç­–ç•¥ï¼ˆG3 è¡¥å……ï¼‰ âœ… å·²å®Œæˆ (2025-12-08)

    -   **ç›®å½•è§„åˆ’**ï¼š
        -   `utils/shared/**`ï¼ˆæˆ– `lib/shared/**`ï¼‰ï¼šä¸ä¾èµ– Nuxt/Node çš„çº¯å‡½æ•°ä¸å¸¸é‡ï¼Œå¯ç›´æ¥è¢«å‰åç«¯å¤ç”¨ã€‚
        -   `utils/web/**`ï¼šåªåœ¨å®¢æˆ·ç«¯ä½¿ç”¨çš„é€»è¾‘ï¼ˆæµè§ˆå™¨ APIã€çª—å£çŠ¶æ€ã€ç»„ä»¶ helperï¼‰ã€‚
        -   `server/utils/**`ï¼šä»…æœåŠ¡ç«¯å¯ç”¨çš„é€»è¾‘ï¼ˆæ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿã€ç¬¬ä¸‰æ–¹æœåŠ¡ï¼‰ã€‚
        -   é€šè¿‡ `barrel` æ–‡ä»¶ï¼ˆindex.tsï¼‰æš´éœ²ç»Ÿä¸€å…¥å£ï¼Œé¿å…è·¨å±‚è¯¯å¼•ç”¨ã€‚
    -   **ä¾èµ–çº¦æŸ**ï¼š
        -   `shared` ä¸å¾—å¼•ç”¨ `web`/`server`ï¼Œ`web` å¯ä»¥å¼•ç”¨ `shared`ï¼Œ`server` å¯ä»¥å¼•ç”¨ `shared`ï¼Œä½†ç¦æ­¢åå‘ä¾èµ–ã€‚
        -   é…ç½® `eslint-plugin-boundaries` æˆ–è‡ªå®šä¹‰ lint è§„åˆ™ï¼Œåœ¨ CI é˜»æ­¢é”™è¯¯å¼•ç”¨ã€‚
    -   **è¿ç§»æ­¥éª¤**ï¼š
        1. ç»Ÿè®¡å½“å‰ `utils/**` ä¸­çš„é€šç”¨é€»è¾‘ï¼ˆå¦‚ `validate`, `privacy`, `password`, `smart-input`ï¼‰ï¼Œä¼˜å…ˆè¿å…¥ `shared`ã€‚
        2. å°†ä»… server ä¾èµ–ï¼ˆfs, node:crypto, TypeORMï¼‰çš„ util æ”¾å…¥ `server/utils` å¹¶æä¾›çº¯é€»è¾‘ + å‰¯ä½œç”¨æ‹†åˆ†ã€‚
        3. Web ç«¯ hooks/composables è‹¥ä»…ä¾èµ–æµè§ˆå™¨ï¼Œç»Ÿä¸€æ”¾å…¥ `utils/web` æˆ– `composables/shared`ã€‚
    -   **å¤ç”¨æ”¶ç›Šè¡¡é‡**ï¼šç»Ÿè®¡å‰åç«¯é‡å¤å®ç°çš„å‡½æ•°æ•°é‡ï¼ˆåŸºçº¿ vs é‡æ„åï¼‰ï¼Œé‡å¤å®ç°æ¸…é›¶ï¼›é€šè¿‡ `pnpm depcruise --config .dependency-cruise.cjs` ç”Ÿæˆä¾èµ–å›¾éªŒè¯å¼•ç”¨å±‚çº§æ­£ç¡®ã€‚

-   **æ‰§è¡Œè®¡åˆ’**ï¼š

    | é˜¶æ®µ   | ä»»åŠ¡         | éªŒæ”¶æ ‡å‡†                                                               |
    | :----- | :----------- | :--------------------------------------------------------------------- |
    | **P1** | åŸºç¡€ç»„ä»¶æŠ½è±¡ | `login.vue`, `register.vue` ä»£ç è¡Œæ•°å‡å°‘ 30%ï¼Œä¸å†åŒ…å«åº•å±‚ HTML æ ‡ç­¾ã€‚ |
    | **P2** | è¡¨æ ¼é€»è¾‘ç»Ÿä¸€ | æ‰€æœ‰ Admin åˆ—è¡¨é¡µç§»é™¤åˆ†é¡µ/åŠ è½½æ‰‹åŠ¨ç»´æŠ¤ä»£ç ï¼Œæ¥å…¥ `useDataTable`ã€‚      |
    | **P3** | æ ¡éªŒè§„åˆ™åŒæ„ | å‰åç«¯ä½¿ç”¨åŒä¸€ä»½ Zod Schemaï¼Œä¿®æ”¹ä¸€å¤„è§„åˆ™ä¸¤ç«¯åŒæ—¶ç”Ÿæ•ˆã€‚                |

-   **é‡åŒ–éªŒè¯**ï¼š
    -   **å·¥å…·**ï¼šå¼•å…¥ `jscpd` (JavaScript Copy/Paste Detector) è¿›è¡Œä»£ç é‡å¤ç‡æ£€æµ‹ã€‚
    -   **æŒ‡æ ‡**ï¼šå…¨é¡¹ç›®ä»£ç é‡å¤ç‡ï¼ˆDuplication Rateï¼‰é™ä½è‡³ **5%** ä»¥ä¸‹ï¼ˆå½“å‰éœ€å…ˆæµ‹å®šåŸºçº¿ï¼‰ã€‚
    -   **CI é›†æˆ**ï¼šåœ¨ CI æµç¨‹ä¸­å¢åŠ  `jscpd` æ£€æŸ¥ï¼Œè¶…è¿‡é˜ˆå€¼æŠ¥è­¦ã€‚

### 3.5 æ ¡éªŒè§„åˆ™åŒæ„ï¼ˆG3 è¡¥å……ï¼‰

-   **ç›®æ ‡**ï¼šåç«¯æ¥å£å…¨é¢æ¥å…¥ Zod Schema æ ¡éªŒï¼Œç¡®ä¿è¾“å…¥æ•°æ®çš„ç±»å‹å®‰å…¨å’Œä¸šåŠ¡è§„åˆ™ä¸€è‡´æ€§ã€‚
-   **ç°çŠ¶åˆ†æ**ï¼š

    -   `server/api/admin/oauth/applications/index.post.ts`ï¼šæ‰‹åŠ¨è§£æ„ bodyï¼Œæ‰‹åŠ¨æ ¡éªŒ `appName` å’Œ `appRedirectURIs`ï¼Œç¼ºä¹ç±»å‹å®šä¹‰ã€‚
    -   `server/api/admin/oauth/applications/[id].put.ts`ï¼šæ‰‹åŠ¨æ£€æŸ¥ `id` å’Œ `body`ï¼Œéƒ¨åˆ†å­—æ®µæ ¡éªŒç¼ºå¤±ã€‚
    -   `server/api/admin/sso/providers/index.post.ts`ï¼šæ‰‹åŠ¨æ ¡éªŒ `type`, `providerId` ç­‰å­—æ®µï¼Œå¤§é‡ `if` åˆ¤æ–­ã€‚
    -   `server/api/admin/sso/providers/[id].put.ts`ï¼šæ‰‹åŠ¨å®šä¹‰ `allowedFields` æ•°ç»„è¿›è¡Œè¿‡æ»¤ï¼Œå®¹æ˜“é—æ¼ã€‚
    -   `server/api/admin/sync-admin-role.post.ts`ï¼šæ‰‹åŠ¨æ£€æŸ¥ `userId`ã€‚
    -   `server/api/oauth/revoke-consent.post.ts`ï¼šæ‰‹åŠ¨æ£€æŸ¥ `clientId`ã€‚
    -   `server/api/file/upload.post.ts`ï¼šä½¿ç”¨ `readMultipartFormData`ï¼Œæ ¡éªŒé€»è¾‘è¾ƒä¸ºç‰¹æ®Šï¼Œæš‚ä¸çº³å…¥ Zod æ”¹é€ èŒƒå›´ã€‚

-   **å®æ–½è®¡åˆ’**ï¼š

    1.  **å®šä¹‰ Schema**ï¼šåœ¨ `utils/shared/schemas.ts` ä¸­å®šä¹‰ API è¯·æ±‚ä½“çš„ Zod Schemaã€‚
        -   `oauthApplicationSchema` (Create/Update)
        -   `ssoProviderSchema` (Create/Update)
        -   `adminRoleSyncSchema`
        -   `revokeConsentSchema`
    2.  **åç«¯æ¥å…¥**ï¼šä½¿ç”¨ `h3-zod` æˆ–æ‰‹åŠ¨ `schema.parse(body)` æ›¿æ¢ç°æœ‰çš„æ‰‹åŠ¨æ ¡éªŒé€»è¾‘ã€‚
    3.  **å‰ç«¯æ¥å…¥**ï¼šå‰ç«¯è¡¨å•æäº¤æ—¶ä½¿ç”¨ç›¸åŒçš„ Schema è¿›è¡Œé¢„æ ¡éªŒï¼ˆå·²åœ¨ 3.3 ä¸­éƒ¨åˆ†æåŠï¼Œæ­¤å¤„å¼ºè°ƒæ¥å£ç»´åº¦çš„ Schemaï¼‰ã€‚

-   **å¾…æ”¹é€ æ¥å£æ¸…å•**ï¼š

    | æ¥å£è·¯å¾„                                         | æ–¹æ³• | æè¿°            | ä¼˜å…ˆçº§ |
    | ------------------------------------------------ | ---- | --------------- | ------ |
    | `server/api/admin/oauth/applications/index.post` | POST | åˆ›å»º OAuth åº”ç”¨ | High   |
    | `server/api/admin/oauth/applications/[id].put`   | PUT  | æ›´æ–° OAuth åº”ç”¨ | High   |
    | `server/api/admin/sso/providers/index.post`      | POST | åˆ›å»º SSO æä¾›å•† | High   |
    | `server/api/admin/sso/providers/[id].put`        | PUT  | æ›´æ–° SSO æä¾›å•† | High   |
    | `server/api/admin/sync-admin-role.post`          | POST | åŒæ­¥ç®¡ç†å‘˜æƒé™  | Medium |
    | `server/api/oauth/revoke-consent.post`           | POST | æ’¤é”€ OAuth æˆæƒ | Medium |

### 4. è¦†ç›–ç‡ â‰¥ 60%ï¼ˆG4ï¼‰

-   **é˜¶æ®µåŒ–æ¨è¿›**ï¼š
    1. **P1**ï¼šçº¯å‡½æ•°/ç¡®å®šæ€§é€»è¾‘ï¼ˆå·²å®Œæˆå¤§éƒ¨åˆ†ï¼Œç»§ç»­è¦†ç›–æ–°å¢ utilï¼‰ã€‚
    2. **P2**ï¼šå‰¯ä½œç”¨è½»é‡æ¨¡å—ï¼ˆrate-limitã€email-serviceã€phone-serviceï¼‰ï¼Œé€šè¿‡ä¾èµ–æ³¨å…¥å’Œ mock å®ç°ã€‚
    3. **P3**ï¼šAPI & ç»„ä»¶é›†æˆï¼›åˆ©ç”¨ `@nuxt/test-utils` + in-memory DB fixtureã€‚
-   **å·¥å…·é…ç½®**ï¼š
    -   åœ¨ `vitest.config.ts` çš„ `coverage` ä¸­è®¾ç½®é˜ˆå€¼ï¼ˆå¦‚ `lines: 0.6`ï¼‰å¹¶è¾“å‡º `lcov`ã€‚
    -   ä¸º PR CI æ–°å¢ `pnpm test --coverage` jobï¼Œæœªè¾¾æ ‡è‡ªåŠ¨å¤±è´¥ã€‚
-   **è¡¥æµ‹æ¸…å•ï¼ˆæ–°å¢ï¼‰**ï¼š
    -   `server/utils/email-service.ts`ï¼ˆæ¨¡æ¿é”™è¯¯ã€é™æµã€sendEmail å¼‚å¸¸ï¼‰ã€‚
    -   `server/utils/phone.ts`ï¼ˆSpug/Twilio åˆ†æ”¯ã€é™æµæ—¥å¿—ï¼‰ã€‚
    -   `server/api/*` å…³é”®è·¯ç”±ï¼ˆauthã€adminã€oauthï¼‰â€”â€”èµ°é»‘ç›’ï¼Œç”¨ fixturesã€‚
    -   æ–°æ‹†å‡ºçš„ composable / Base ç»„ä»¶ã€‚

### 5. æ–‡æ¡£åŒæ­¥ï¼ˆG5ï¼‰

-   **æ–°å¢æ–‡æ¡£**ï¼š
    -   æœ¬æ–‡ä»¶ `docs/REFACTOR_PLAN.md`ã€‚
    -   `docs/architecture/decoupling.md`ï¼šè¯´æ˜æ–°å±‚æ¬¡ã€æ¨¡å—èŒè´£ã€‚
    -   `docs/testing/coverage.md`ï¼šè®°å½•è¦†ç›–ç­–ç•¥ã€è¿è¡Œå‘½ä»¤ã€å¤¹å…·è¯´æ˜ã€‚
-   **æ›´æ–°å†…å®¹**ï¼š
    -   `README.md`ï¼šåŠ å…¥â€œæ¶æ„ & è´¨é‡å®ˆæŠ¤â€ç« èŠ‚ä¸è¦†ç›–ç‡å¾½ç« ã€‚
    -   `docs/PLAN.md` & `docs/TEST.md`ï¼šåæ˜ å½“å‰è¿›åº¦ã€é˜¶æ®µç›®æ ‡ã€‚
    -   `CHANGELOG.md`ï¼šåœ¨å¯¹åº” release ä¸­åˆ—å‡ºé‡æ„ä¸æµ‹è¯•æå‡ã€‚
-   **æµç¨‹çº¦æŸ**ï¼šPR æ¨¡æ¿æ–°å¢ â€œæ–‡æ¡£åŒæ­¥â€ å¤é€‰æ¡†ï¼›ç¼ºå¤±æ—¶ reviewer å¯ç›´æ¥æ‹’ç»ã€‚

### 6. Lint è¦æ±‚ï¼ˆESLint & Stylelintï¼‰

-   **ç›®æ ‡**ï¼š
    -   CI ä¸­ `pnpm lint`ã€`pnpm stylelint` å¿…é¡» 0 errorï¼›warning æ•°é‡é€ Sprint ä¸‹é™ï¼Œæœ€ç»ˆç›®æ ‡æ§åˆ¶åœ¨ 0-5 ä»¥å†…ã€‚
    -   ä»»ä½•æ–°å¢ä»£ç ä¸å¾—å¼•å…¥æ–°çš„ lint warningï¼Œé™¤éæœ‰ eslint-disable æ³¨é‡Šå¹¶æ³¨æ˜åŸå› ã€‚
-   **ç­–ç•¥**ï¼š
    1. åœ¨ lint å‘½ä»¤åè¿½åŠ  `--max-warnings=0`ï¼ˆå…ˆåœ¨ CI å®éªŒï¼Œè§†é—ç•™ warning æ•°é‡é€æ­¥æ”¶ç´§ï¼‰ã€‚
    2. å»ºç«‹ `lint-baseline.json` è®°å½•å½“å‰ warningï¼Œé€æ–‡ä»¶æ¸…é›¶åä»åŸºçº¿ç§»é™¤ã€‚
    3. Stylelint åŒæ­¥é…ç½® `--max-warnings=0` å¹¶ç»Ÿä¸€ SCSS å˜é‡/æ··å…¥ä½¿ç”¨ï¼›å¯¹è€æ—§æ ·å¼é€æ­¥æ•´æ”¹ã€‚
-   **éªŒæ”¶**ï¼šCI é€šè¿‡æ—¶æ—  lint errorï¼Œwarning æ•°æŒ‰è®¡åˆ’ä¸‹é™ï¼›PR æ¨¡æ¿è¦æ±‚é™„ä¸Š lint ç»“æœï¼ˆæˆ– CI é“¾æ¥ï¼‰ã€‚

### 7. åŸå­ä¿®æ”¹ä¸æµ‹è¯•é—­ç¯

-   **è§„å®š**ï¼šæ¯æ¬¡ä¿®æ”¹æ—¶åªæ”¹ä¸€é¡¹å†…å®¹ï¼Œå¹¶éœ€è¦å®Œæˆæµ‹è¯•ã€‚
-   **æ‰§è¡Œ**ï¼š
    -   ä¸¥ç¦åœ¨ä¸€ä¸ªæäº¤æˆ– PR ä¸­æ··æ‚å¤šä¸ªä¸ç›¸å…³çš„é‡æ„ä»»åŠ¡ã€‚
    -   ä¿®æ”¹å®Œæˆåï¼Œå¿…é¡»è¿è¡Œå¯¹åº”çš„å•å…ƒæµ‹è¯•æˆ–é›†æˆæµ‹è¯•ï¼Œç¡®ä¿ä¸ç ´åç°æœ‰åŠŸèƒ½ã€‚
    -   è‹¥ä¿®æ”¹æ¨¡å—ç¼ºä¹æµ‹è¯•ï¼Œå¿…é¡»å…ˆè¡¥å……æµ‹è¯•ã€‚

### 8. ç±»å‹å®‰å…¨

-   **ç›®æ ‡**ï¼šæ‰€æœ‰ä¿®æ”¹å’Œæ–°å¢ä»£ç å¿…é¡»é€šè¿‡ TypeScript ç±»å‹æ£€æŸ¥ã€‚
-   **æ‰§è¡Œ**ï¼š
    -   ä¸¥ç¦ä½¿ç”¨ `// @ts-ignore` æˆ– `any` é€ƒé¿ç±»å‹æ£€æŸ¥ï¼Œé™¤éæœ‰æç‰¹æ®Šç†ç”±å¹¶ç»è¿‡ Reviewã€‚
    -   æ‰§è¡Œ `npm run typecheck` è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚
    -   åœ¨æäº¤å‰è¿è¡Œç±»å‹æ£€æŸ¥å‘½ä»¤ï¼Œç¡®ä¿æ— æŠ¥é”™ã€‚

## æ‰§è¡Œè·¯çº¿å›¾

| é˜¶æ®µ     | æ—¶é—´   | é‡ç‚¹                                       | äº¤ä»˜                                    |
| -------- | ------ | ------------------------------------------ | --------------------------------------- |
| Sprint 1 | 1 å‘¨   | çº¯å‡½æ•°æ¢³ç†ã€max-lines æ£€æŸ¥ã€è¡¥å……è¦†ç›–ç‡é…ç½® | util è§£è€¦ã€eslint è§„åˆ™ã€coverage job    |
| Sprint 2 | 1-2 å‘¨ | å¤§æ–‡ä»¶æ‹†åˆ†ã€å…¬å…±ç»„ä»¶æŠ½è±¡ã€email/phone æµ‹è¯• | æ‹†åˆ†åçš„æ¨¡å—ã€Base ç»„ä»¶åº“ã€æœåŠ¡å•æµ‹     |
| Sprint 3 | 2 å‘¨   | API & ç»„ä»¶é›†æˆæµ‹è¯•ã€æ–‡æ¡£å®Œå–„               | e2e/é›†æˆæµ‹è¯•ã€docs æ›´æ–°ã€coverage â‰¥ 60% |

## æˆåŠŸåº¦é‡

-   **æŠ€æœ¯æŒ‡æ ‡**ï¼š
    -   `pnpm lint` ä¸ `pnpm test --coverage` å‡ä¸º CI å¿…è·‘é¡¹ã€‚
    -   `depcruise` å›¾æ— å¾ªç¯ä¾èµ–ï¼Œ`madge` æŠ¥å‘Šæ¸…é›¶ã€‚
    -   `sonarqube` æˆ– `codecov` æŠ¥å‘Šæ˜¾ç¤ºè¦†ç›–ç‡ â‰¥ 60%ã€‚
-   **è¿‡ç¨‹æŒ‡æ ‡**ï¼š
    -   æ¯ä¸ª refactor PR åŒ…å«æ‹†åˆ†è¯´æ˜ã€æµ‹è¯•æˆªå›¾ã€æ–‡æ¡£æ›´æ–°é“¾æ¥ã€‚
    -   å½¢æˆâ€œçº¯é€»è¾‘å…ˆå†™å•æµ‹â€çš„å¼€å‘ä¹ æƒ¯ï¼Œreview checklist åŒ…å«â€œå‰¯ä½œç”¨éš”ç¦»â€é¡¹ã€‚

## åç»­å»ºè®®

-   æŒ‰å­£åº¦å›é¡¾ max-lines å’Œå¤ç”¨æ•ˆæœï¼Œé˜²æ­¢å›é€€ã€‚
-   è‹¥åç»­éœ€è¦è¿›ä¸€æ­¥è‡ªåŠ¨åŒ–ï¼Œå¯å¼•å…¥ `nx` æˆ– `turbo` åˆ†æ¨¡å—æ„å»ºï¼Œæé«˜è§£è€¦ç²’åº¦ã€‚
-   é’ˆå¯¹é«˜é£é™©æ¨¡å—ï¼ˆè®¤è¯ã€æ”¯ä»˜ã€æ—¥å¿—ï¼‰å¢åŠ å¥‘çº¦æµ‹è¯•ï¼Œä¿è¯æ‹†åˆ†åè¡Œä¸ºä¸€è‡´ã€‚
