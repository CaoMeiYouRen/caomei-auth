# QQ 登录配置指南

QQ 是腾讯旗下的即时通讯软件，在中国拥有庞大的用户群体，适合面向中国用户的应用。

## 前置要求

- 拥有 QQ 账户
- 需要在 QQ 互联平台创建应用
- 需要完成开发者认证

## 配置步骤

### 1. 注册 QQ 互联开发者

1. 访问 [QQ 互联开放平台](https://connect.qq.com/)
2. 点击 **开发者注册**
3. 使用 QQ 账户登录
4. 完成开发者认证：
   - **个人开发者**: 需要身份证验证
   - **企业开发者**: 需要营业执照等企业资质

### 2. 创建应用

认证通过后：

1. 登录 QQ 互联管理中心
2. 点击 **应用管理** > **创建应用**
3. 选择应用类型：**网站应用**
4. 填写应用信息：
   - **应用名称**: `草梅Auth`
   - **应用简介**: 详细描述应用功能和用途
   - **应用网址**: `https://yourdomain.com`
   - **应用备案号**: 如有ICP备案号请填写
   - **回调地址**: `https://yourdomain.com/api/auth/callback/qq`

### 3. 应用审核

提交应用后：

1. 等待腾讯审核（通常1-7个工作日）
2. 审核期间可能需要补充材料
3. 审核通过后应用状态变为"审核通过"

### 4. 获取应用凭据

审核通过后，在应用详情页面获取：

- **APP ID**: 应用的唯一标识
- **APP Key**: 应用密钥

### 5. 配置环境变量

在项目的 `.env` 文件中添加：

```env
# QQ 登录配置
QQ_CLIENT_ID=your_qq_app_id
QQ_CLIENT_SECRET=your_qq_app_key
QQ_USE_UNIONID=false
```

### 6. 重启应用

保存环境变量后，重启应用以使配置生效。

## 权限说明

QQ 登录可以获取以下用户信息：

### 基础信息
- QQ 号码（加密）
- 昵称
- 头像
- 性别
- 省份和城市
- 年龄段

### 扩展信息
- 个人说明
- 认证信息
- VIP 信息
- 黄钻信息

## OpenID vs UnionID

### OpenID
- **说明**: 用户在当前应用的唯一标识
- **特点**: 每个应用获得的 OpenID 不同
- **使用**: 适合单一应用

### UnionID
- **说明**: 用户在同一开发者所有应用中的统一标识
- **特点**: 同一开发者的不同应用获得相同 UnionID
- **使用**: 适合多应用生态

### 配置 UnionID

```env
# 启用 UnionID（需要申请权限）
QQ_USE_UNIONID=true
```

## 测试登录

1. 访问登录页面
2. 点击 QQ 登录按钮
3. 在 QQ 授权页面登录并授权
4. 成功登录后会跳转回应用

## 应用上线流程

### 开发阶段

新创建的应用默认处于开发状态：

- 只有开发者可以登录测试
- 可以添加协作者账号
- 功能和调用量有限制

### 上线申请

1. 在应用管理页面点击 **申请上线**
2. 填写上线申请信息：
   - 应用功能说明
   - 用户规模预期
   - 商业模式说明
3. 提供应用截图和演示
4. 等待审核（通常1-2周）

### 上线后

- 所有 QQ 用户都可以使用
- API 调用量限制放宽
- 可以申请更多高级权限

## 常见问题

### 1. redirect_uri_mismatch

**原因**: 回调地址不匹配

**解决方案**:
- 检查 QQ 互联平台中配置的回调地址
- 确保地址完全匹配
- 注意 HTTP/HTTPS 协议区别

### 2. invalid_client

**原因**: APP ID 或 APP Key 错误

**解决方案**:
- 检查环境变量配置
- 确认应用凭据正确无误
- 注意区分 APP ID 和 APP Key

### 3. unauthorized_client

**原因**: 应用未通过审核或状态异常

**解决方案**:
- 检查应用审核状态
- 确认应用已正式上线
- 联系 QQ 互联客服

### 4. access_denied

**原因**: 用户拒绝授权或权限不足

**解决方案**:
- 检查申请的权限范围
- 优化授权页面说明
- 确保权限申请合理

## 用户数据示例

```javascript
// QQ 用户信息结构
{
  openid: "B624064BA47...", // 用户在该应用的唯一标识
  unionid: "UID_8C8A48...", // 用户在开发者所有应用的统一标识（可选）
  nickname: "用户昵称",
  figureurl: "头像URL（30x30）",
  figureurl_1: "头像URL（50x50）",
  figureurl_2: "头像URL（100x100）",
  figureurl_qq: "QQ头像URL（40x40）",
  figureurl_qq_1: "QQ头像URL（100x100）",
  figureurl_qq_2: "QQ头像URL（原始大小）",
  gender: "男", // 性别
  province: "北京", // 省份
  city: "北京", // 城市
  year: "1990", // 出生年份
  constellation: "水瓶座", // 星座
  ret: 0 // 返回码，0表示成功
}
```

## API 限制和配额

### 调用频率限制

- **开发应用**: 1000次/小时
- **上线应用**: 10000次/小时
- **特殊权限**: 更高限额（需申请）

### 用户量限制

- **开发应用**: 100个测试用户
- **上线应用**: 无限制
- **企业应用**: 根据协议确定

## 高级功能

### 获取好友列表

需要申请 `get_user_friends` 权限：

```javascript
// 获取好友列表（需要特殊权限）
const friends = await qqAPI.getFriends(accessToken, openid);
```

### 分享到 QQ 空间

集成 QQ 空间分享功能：

```javascript
// 分享到QQ空间
await qqAPI.shareToQzone({
  title: '分享标题',
  summary: '分享摘要',
  url: 'https://yourdomain.com',
  images: ['图片URL']
});
```

## 移动端集成

### QQ SDK

如果有移动应用，可以集成 QQ SDK：

- **Android**: QQ 登录 SDK for Android
- **iOS**: QQ 登录 SDK for iOS
- **统一账号**: 使用 UnionID 实现账号统一

### 跨平台一致性

确保 Web 和移动端：

- 使用相同的 APP ID
- 获取相同的 UnionID
- 用户体验一致

## 品牌使用规范

使用 QQ 登录时的要求：

- **颜色**: 使用腾讯 QQ 官方蓝色 `#1296DB`
- **图标**: 使用 QQ 官方图标
- **文案**: "QQ登录" 或 "使用QQ账号登录"
- **按钮样式**: 符合 QQ 品牌规范

### 官方素材下载

在 QQ 互联平台可以下载：

- QQ 登录按钮素材
- QQ 图标素材
- 使用规范文档

## 安全注意事项

### 数据保护

1. **openid 加密**: 对 openid 进行加密存储
2. **访问令牌安全**: 妥善保管 access_token
3. **HTTPS 传输**: 确保数据传输安全

### 合规要求

1. **用户隐私**: 明确告知用户数据使用方式
2. **数据最小化**: 只获取必要的用户信息
3. **数据保留**: 制定合理的数据保留策略

## 故障排除

### 调试工具

QQ 互联提供调试工具：

1. **接口调试工具**: 测试 API 调用
2. **错误码查询**: 查看详细错误信息
3. **日志查看**: 查看应用调用日志

### 常见错误码

- `100000`: 请求成功
- `100001`: 请求参数错误
- `100002`: 请求频率过快
- `100003`: 权限不足
- `100004`: 签名错误

## 相关链接

- [QQ 互联开放平台](https://connect.qq.com/)
- [QQ 登录开发文档](https://wiki.connect.qq.com/qq%e7%99%bb%e5%bd%95)
- [API 调用说明](https://wiki.connect.qq.com/api%e5%88%97%e8%a1%a8)
- [错误码说明](https://wiki.connect.qq.com/%e5%85%ac%e5%85%b1%e8%bf%94%e5%9b%9e%e7%a0%81%e8%af%b4%e6%98%8e)
