# 管理员角色自动同步功能

## 概述

本项目已实现了管理员角色的自动同步功能，解决了当用户仅在 `adminUserIds` 配置中但角色中没有 `admin` 的不一致问题。

## 功能特性

### 1. 自动同步机制

-   **中间件集成**: 在认证中间件 (`server/middleware/1-auth.ts`) 中，每次用户请求都会自动检查并同步管理员角色
-   **实时同步**: 确保用户的角色信息与配置保持一致

### 2. 管理员判定逻辑

用户被视为管理员的条件（满足任一即可）：

-   用户 ID 在环境变量 `ADMIN_USER_IDS` 列表中
-   用户角色字段包含 `admin`

### 3. 角色同步规则

-   **自动添加**: 如果用户在 `adminUserIds` 中但角色中没有 `admin`，会自动添加
-   **保持现有**: 如果用户不在 `adminUserIds` 中但角色中有 `admin`，不会自动移除（保护手动设置的管理员）

